---
layout : post
categories : Microservice_Architecture
title: Docker를 이용한 배포
excerpt: 마이크로 서비스 여행 출발 _ 021
---

## 배포대상
* Design Deployment
* Configuration server
* Eureka Discovery
* API Gateway
* MariaDB
* Kafka
* Zipkin
* Monitoring
* Microservices
* Multiple Environments

#### 스프링 클라우드 자바
Users Microservice
Catalogs Microservice
Orders Microservice
Eureka
API Gateway
Configuration

#### RabbitMQ
#### MariaDB
#### Kafka 
#### Zipkin 분산트래킹
#### Prometheus
#### Grafana


## Docker Network
* Bridge network
 - docker network create --driver bridge [브릿지 이름]
* Host network
* None network

### 네트워크 생성
- docker system prune  
사용하지 않는 네트워크 사용하지 않는 컨테이너 필요없는 리소스 모두 삭제
- docker network ls  
현재 네트워크의 정보를 볼 수 있음
- docker network create --gateway 192.168.114.4 --subnet 192.168.114.4/24 ecommerce-network  
네트워크 생성
- docker network inspect ecommerce-network  
네트워크 상세정보 확인

#### config-server 배포
1. RabbitMQ 
- docker run -d --name rabbitmq --network ecommerce-network -p 15672:15672 -p 5672:5672 -p 15671:15671 -p 5671:5671 -p 4369:4369 -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest rabbitmq:management  
이미지 생성 및 실행
- docker network inspect ecommerce-network  
네트워크에 컨테이너가 포함되어 있는지 확인
2. Config Server 
함께 업로드할 파일 jks 파일 복사
빌드될 서비스 버전 1.0으로 변경
Dockerfile 생성
터미널에서 service 빌드 실행 ( gradlew.bat )
도커 빌드
- docker build -t tp1130/config-server:1.0 .
도커로 실행
- docker run -d -p 8888:8888 --network ecommerce-network -e "spring.rabbitmq.host=rabbitmq" -e "spring.profiles.active=default" --name config-service edowon0623/config-service:1.0
- docker run -d -p 8888:8888 --network ecommerce-network -e "spring.rabbitmq.host=rabbitmq" -e "spring.profiles.active=default" --name config-server edowon0623/config-server:1.0
